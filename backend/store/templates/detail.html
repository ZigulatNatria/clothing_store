<!DOCTYPE html>
{% extends 'base.html' %}
<html lang="en">
    <body>
        {% block content%}
        {% load static %}
        <!-- Стили для слайдера -->
        <link rel="stylesheet" href="{% static 'slider/style.css' %}" type="text/css" media="screen" />

        <!-- Стили для просмотра изображений -->
        <style type="text/css">
			 #thumbs { padding-top: 10px; overflow: hidden; }
			 #thumbs #largeImage { border: 1px solid gray; padding: 4px; background-color: white; cursor: pointer; }
			 #thumbs { float: left; margin-right: 6px; }
			 #description { background: black; color: white; position: absolute; bottom: 0; padding: 10px 20px; width: 525px; margin: 5px; }
			 #panel { position: relative; }
			 #imgphoto { width: 30%; }
		</style>

        <div class="bg-body-tertiary">
            <ul class="nav justify-content-center" style="background-color: #9DA89C; margin-bottom: 1rem;">
                {% for cat in view.nav %}
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="{% url 'category_clothing' cat.id %}" style="color: snow;">
                    {{cat.name}}
                    <img src="/static/ico/downmenu.png">
                </a>
              </li>
                {% endfor %}
                <li class="nav-item" style="z-index:2">
                  <a class="nav-link active" aria-current="page" href="#" style="color: white">
                      Капсулы
                  </a>
              </li>
            </ul>
        </div>
        <div class="container">
            <div class="row align-items-start" style="margin-bottom: 2rem">
                <div class="col-7">
                    <div id="panel" style="min-height: 500px; max-height: 500px; background-color: #222; display: flex; align-items: center; justify-content: center;">
                        <img id="largeImage" style="max-width: 100%; max-height: 500px; flex: 0 0 auto; display: flex;" src="{{MEDIA_URL}} {{product.photo_1.url}}" />
                    </div>
                    <div class="row">
                <div class="col">
                    <div class="row justify-content-start" id="thumbs">
                        <div class="col-2" style="width: 20%;">
                            <div class="card h-100" style="width: 100%;">
                                <img src="{{MEDIA_URL}}{{product.photo_1.url}}" class="card-img-top" alt="...">
                             </div>
                        </div>
                        <div class="col-2" style="width: 20%;">
                            <div class="card h-100" style="width: 100%;">
                                <img src="{{MEDIA_URL}}{{product.photo_2.url}}" class="card-img-top" alt="...">
                            </div>
                        </div>
                        <div class="col-2" style="width: 20%;">
                            <div class="card h-100" style="width: 100%;">
                                <img src="{{MEDIA_URL}}{{product.photo_3.url}}" class="card-img-top" alt="...">
                            </div>
                        </div>
                        <div class="col-2" style="width: 20%;">
                            <div class="card h-100" style="width: 100%;">
                                <img src="{{MEDIA_URL}}{{product.photo_4.url}}" class="card-img-top" alt="...">
                            </div>
                        </div>
                        <div class="col-2" style="width: 20%;">
                            <div class="card h-100" style="width: 100%;">
                                <img src="{{MEDIA_URL}}{{product.photo_5.url}}" class="card-img-top" alt="...">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                </div>
                <div class="col" style="margin-left: 2rem">
                    <h3 style="padding: 0; margin: 0">{{ product.name }}</h3>
                    <div class="row" style="margin-bottom: 1rem; color: darkgrey; padding: 0; margin-left: 0">
                        Арт.{{ product.vendor_code }}
                    </div>
                     <h3 style="color: #825934; margin-bottom: 1rem;">{{ product.price }} ₽</h3>
                     <div class="row" style="padding: 0; margin: 0">
                         Цвет:
                     </div>
                     <div class="row" style="margin-bottom: 1rem">
                     {% for colors_product in view.color %}
                        {% if colors_product %}
                         {% if colors_product.id != product.id %}
                     <div class="col-2 align-self-end">
                         <div class="row">
                            <a href="{% url 'product' colors_product.id %}">
                                <img style="width: 100%" src="{{MEDIA_URL}} {{colors_product.photo_1.url}}">
                            </a>
                         </div>
                         <div class="row" style="padding: 0; margin-left: 0">
                            {{ colors_product.colors.color }}
                         </div>
                     </div>
                         {% endif %}
                        {% endif %}
                     {% endfor %}
                     </div>
                     <div class="row" style="margin-bottom: 1rem; padding: 0; margin-left: 0">
                         Размер:
                         <div class="row" style="padding: 0; margin-left: 0">
                              {{ product.size.all|join:" &nbsp " }}
                         </div>
                     </div>
                     <div class="row" style="margin-bottom: 1rem">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#exampleModal" style="color: #000000">Как выбрать размер?</a>
                     </div>
                     <div class="row" style="margin-bottom: 1rem; padding: 0; margin-left: 0">
                         <div class="col" style="padding: 0; margin-left: 0;">
                             Наличие на складе:
                         </div>
                         <div class="col" style="text-align: right">
                         {% if view.stock == 3 %}
                            <img src="/static/ico/empty_dot.png">
                            <img src="/static/ico/empty_dot.png">
                            <img src="/static/ico/empty_dot.png">
                         {% elif view.stock == 2 %}
                            <img src="/static/ico/empty_dot.png">
                            <img src="/static/ico/empty_dot.png">
                            <img src="/static/ico/filled_dot.png">
                         {% elif view.stock == 1 %}
                            <img src="/static/ico/empty_dot.png">
                            <img src="/static/ico/filled_dot.png">
                            <img src="/static/ico/filled_dot.png">
                         {% elif view.stock == 0 %}
                            <img src="/static/ico/filled_dot.png">
                            <img src="/static/ico/filled_dot.png">
                            <img src="/static/ico/filled_dot.png">
                         {% endif %}
                         </div>
                     </div>
                     <div class="row" style="padding: 0; margin-left: 0">
                        <div class="list-group list-group-horizontal" id="list-tab" role="tablist">
                          <a class="list-group-item-action active" id="list-home-list" data-bs-toggle="list" href="#list-home" role="tab" aria-controls="list-home">Описание</a>
                          <a class="list-group-item-action" id="list-profile-list" data-bs-toggle="list" href="#list-profile" role="tab" aria-controls="list-profile" style="text-align: center">Характеристики</a>
                          <a class="list-group-item-action" id="list-messages-list" data-bs-toggle="list" href="#list-messages" role="tab" aria-controls="list-messages" style="text-align: right">Состав и уход</a>
                        </div>
                      </div>
                     <div class="row" style="margin-bottom: 1rem">
                        <div class="tab-content" id="nav-tabContent">
                          <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">{{ product.description }}</div>
                          <div class="tab-pane fade" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">
                              <div class="row">
                                  <table class="table">
                                      <tbody style="border-style: none">
                                          <tr style="border-style: none">
                                              <td style="border-style: none">
                                                  Размер товара на модели:
                                              </td>
                                              <td style="border-style: none; text-align: right">
                                                  {{ product.size_on_model }}
                                              </td>
                                          </tr>
                                          <tr style="border-style: none">
                                              <td style="border-style: none">
                                                  Коллекция:
                                              </td>
                                              <td style="border-style: none; text-align: right">
                                                  {{ product.collection }}
                                              </td>
                                          </tr>
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                          <div class="tab-pane fade" id="list-messages" role="tabpanel" aria-labelledby="list-messages-list">{{ product.compound }}</div>
                        </div>
                     </div>

                    <div class="row align-items-center">
                        <div class="col">
                             <form action="{% url 'cart_add' product.id %}" method="post">
                                 <!--
                                 <div >{{ view.product_add_cart }}</div>
                                 -->
                                 <div class="row">
                                     <div class="col">
                                         <div>{{ view.product_add_cart.color.label_tag }}</div>
                                         <div>{{ view.product_add_cart.color }}</div>
                                     </div>
                                     <div class="col">
                                         <div>{{ view.product_add_cart.size.label_tag }}</div>
                                         <div>{{ view.product_add_cart.size }}</div>
                                         <div style="visibility: hidden">{{ view.product_add_cart.quantity }}</div>
                                      </div>
                                 </div>
                                {% csrf_token %}
                                <button type="submit" class="btn" style="margin-top: 10px;
                                                                         border-radius: 20px;
                                                                                    --bs-btn-color: #FFFFFF;
                                                                                    --bs-btn-bg: #825934;
                                                                                    --bs-btn-border-color: #8b4513;
                                                                                    --bs-btn-hover-color: #fff;
                                                                                    --bs-btn-hover-bg: #b35c1e;
                                                                                    --bs-btn-hover-border-color: #8b4513;
                                                                                    --bs-btn-focus-shadow-rgb: 49,132,253;
                                                                                    --bs-btn-active-color: #fff;
                                                                                    --bs-btn-active-bg: #8b4513;
                                                                                    --bs-btn-active-border-color: #8b4513;
                                                                                    --bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
                                                                                    --bs-btn-disabled-color: #fff;
                                                                                    --bs-btn-disabled-bg: #8b4513;
                                                                                    --bs-btn-disabled-border-color: #8b4513;">
                                    Добавить в корзину
                                </button>
                            </form>
                        </div>
                        <div class="col-4 align-self-end">
                            {% if product.name in request.user.favorite_products.all|join:", " %}
                                <form action="{% url 'delete_favorite' %}" method="post" style="text-align: right">
                                    {% csrf_token %}
                                    <input type="hidden" name="id_cat" value={{product.id}}>
                                    <button type="submit" class="btn" style="background-color: #fff0; border: #fff0; padding-right:0">
                                            Удалить из избранного <img src="/static/ico/favorite3.png">
                                    </button>
                                </form>
                            {% else %}
                                <form action="{% url 'add_favorite' %}" method="post" style="text-align: right">
                                    {% csrf_token %}
                                    <input type="hidden" name="id_cat" value={{product.id}}>
                                    <button type="submit" class="btn" style="background-color: #fff0; border: #fff0; padding-right:0">
                                            В избранное <img src="/static/ico/favorite.png">
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                 </div>
            </div>
            <div class="row">
                <div class="col-4">
                    <h4>Вам может понравиться</h4>
                </div>
                <div class="row justify-content-start" style="z-index: 0">
                    <div class="col-6" style="margin-bottom: 10vh">
                        <div id="newsticker-demo">
                            <div class="newsticker-jcarousellite">
                                <ul>
                                     {% for i in view.all_product_collection %}
                                    <li>
                                        <div class="thumbnail">
                                            <div class="card h-100" style="width: 100%; --bs-card-border-color: 0;">
                                                <a href="{% url 'product' i.id %}">
                                                    <img src="{{MEDIA_URL}}{{i.photo_1.url}}" class="d-block w-100" alt="...">
                                                </a>
                                                <div class="card-body" style="background-color: #FFFFFF; width: 100%">
                                                    <div class="row">
                                                         <div class="col-10">
                                                             {{i.name}}
                                                             <div style="color: #825934; font-weight: bold">{{i.price}} ₽</div>
                                                         </div>
                                                         <div class="col-2" style="text-end">
                                                             <img src="/static/ico/favorite.png">
                                                         </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="clear"></div>
                                    </li>
                                     {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- JS для просмотра изображений -->
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>

        <!-- JS для слайдера -->
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="{% static 'slider/jcarousellite_1.0.1.min.js' %}" type="text/javascript"></script>
        <script type="text/javascript">
        $(function() {
            $(".newsticker-jcarousellite").jCarouselLite({
                vertical: false,
                hoverPause:true,
                visible: 5,
                auto:500,
                speed:1500
            });
        });
        </script>

        <!-- pcvector.net -->
        <script type="text/javascript" src="/templates/pcv/js/pcvector.js"></script>
        <!-- /pcvector.net -->
        <script>
        $('#thumbs').delegate('img','click', function(){
            $('#largeImage').attr('src',$(this).attr('src').replace('thumb','large'));
            $('#description').html($(this).attr('alt'));
        });
        </script>

        <!-- Модальное окно -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Выбор размера</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
              </div>
              <div class="modal-body">
                    <img src="/static/img/size2.png" style="width: 100%;">
              </div>
              <div class="modal-footer">
                <button type="button" class="btn" data-bs-dismiss="modal" style="margin-top: 10px;
                                                                         border-radius: 20px;
                                                                                    --bs-btn-color: #FFFFFF;
                                                                                    --bs-btn-bg: #825934;
                                                                                    --bs-btn-border-color: #8b4513;
                                                                                    --bs-btn-hover-color: #fff;
                                                                                    --bs-btn-hover-bg: #b35c1e;
                                                                                    --bs-btn-hover-border-color: #8b4513;
                                                                                    --bs-btn-focus-shadow-rgb: 49,132,253;
                                                                                    --bs-btn-active-color: #fff;
                                                                                    --bs-btn-active-bg: #8b4513;
                                                                                    --bs-btn-active-border-color: #8b4513;
                                                                                    --bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
                                                                                    --bs-btn-disabled-color: #fff;
                                                                                    --bs-btn-disabled-bg: #8b4513;
                                                                                    --bs-btn-disabled-border-color: #8b4513;">
                    Закрыть
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Модальное для цветов одежды -->
        {% for color in view.color %}
            {% if color %}
                <div class="modal fade" id="{{ color.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="{{ color.id }}Label">{{ color.name_color }}</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                            </div>
                            <div class="modal-body">
                                <div id="carousel{{ color.id }}Indicators" class="carousel slide">
                                    <div class="carousel-indicators">
                                        <button type="button" data-bs-target="#carousel{{ color.id }}Indicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                                        <button type="button" data-bs-target="#carousel{{ color.id }}Indicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
                                        <button type="button" data-bs-target="#carousel{{ color.id }}Indicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
                                        <button type="button" data-bs-target="#carousel{{ color.id }}Indicators" data-bs-slide-to="3" aria-label="Slide 4"></button>
                                        <button type="button" data-bs-target="#carousel{{ color.id }}Indicators" data-bs-slide-to="4" aria-label="Slide 5"></button>
                                    </div>
                                    <div class="carousel-inner">
                                        <div class="carousel-item active">
                                            <img style="width: 100%" src="{{MEDIA_URL}} {{color.photo_1.url}}">
                                        </div>
                                        <div class="carousel-item">
                                            <img style="width: 100%" src="{{MEDIA_URL}} {{color.photo_2.url}}">
                                        </div>
                                        <div class="carousel-item">
                                            <img style="width: 100%" src="{{MEDIA_URL}} {{color.photo_3.url}}">
                                        </div>
                                        <div class="carousel-item">
                                            <img style="width: 100%" src="{{MEDIA_URL}} {{color.photo_4.url}}">
                                        </div>
                                        <div class="carousel-item">
                                            <img style="width: 100%" src="{{MEDIA_URL}} {{color.photo_5.url}}">
                                        </div>
                                    </div>
                                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ color.id }}Indicators" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Предыдущий</span>
                                    </button>
                                    <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ color.id }}Indicators" data-bs-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Следующий</span>
                                    </button>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
        <script type="text/javascript">
        var const = '{% url "user_follow" %}';
         var options = {
         method: 'POST',
         headers: {'X-CSRFToken': csrftoken},
         mode: 'same-origin'
         }
         document.querySelector('a.follow')
         .addEventListener('click', function(e){
         e.preventDefault();
         var followButton = this;

         // добавить тело запроса
         var formData = new FormData();
         formData.append('id', followButton.dataset.id);
         formData.append('action', followButton.dataset.action);
         options['body'] = formData;

         // отправить HTTP-запрос
         fetch(url, options)
        .then(response => response.json())
         .then(data => {
         if (data['status'] === 'ok')
         {
         var previousAction = followButton.dataset.action;

         // переключить текст кнопки и data-action
         var action = previousAction === 'follow' ? 'unfollow' : 'follow';
         followButton.dataset.action = action;
         followButton.innerHTML = action;

         // обновить количество подписчиков
         var followerCount = document.querySelector('span.count .total');
         var totalFollowers = parseInt(followerCount.innerHTML);
         followerCount.innerHTML = previousAction === 'follow' ? totalFollowers + 1 :
        totalFollowers – 1;
         }
         })
         });
         </script>
        {% endblock content %}
    </body>
</html>